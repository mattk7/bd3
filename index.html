<html>

    <head>
        <script src="libs/d3.min.js"></script>
    </head>
    
    <body>
        <button id="btn">Flip</button>
        <svg height="5000" width="5000"></svg>
        <script>

        var upVar = 'Medals';
        var downVar = 'Population (Total)';

            
       
            
        d3.json('./Data/data_joined.json', function(json_data){
                var data = d3.entries(json_data);
                              
        function update(upVar, downVar) {          
                     data.sort(function(a, b){
                         return d3.descending(a.value[upVar] || 0, b.value[upVar] || 0)
                     }) 
                       
                console.log(data);
        
                var svg = d3.select('svg')
                    .selectAll('g')
                    .data(data, function(d){return d.key;})
                    //.data(data)
                
                var groups = svg.enter()
                            .append('g')

                
                
                var upMin = d3.min(data, function(d){
                    return d.value[upVar] || 0;  
                })                
                
                var upMax = d3.max(data, function(d){
                    return d.value[upVar] || 0;  
                })                
                
                var downMin = d3.min(data, function(d){
                    return d.value[downVar] || 0;  
                })                
                
                var downMax = d3.max(data, function(d){
                    return d.value[downVar] || 0;  
                })                
                
                var lenRange = 300.0;

                var upMap = d3.scale.linear()
                                .domain([upMin, upMax])
                                .range([0, lenRange]);
                                
                var downMap = d3.scale.linear()
                                .domain([downMin, downMax])
                                .range([0, lenRange]);
                var startY = lenRange*1.05;
                var startX = 10;

                var upRect = groups
                    .append('rect')
                    .attr('transform', function(d, i){return 'translate(' + i*startX*0 + ',' + startY + ')'; })
	                .attr("y", function(d) { return -upMap(d.value[upVar] || 0); })
                    .attr("class", "up")

                var downRect = groups
                    .append('rect')
                    .attr('transform', function(d, i){return 'translate(' + i*startX*0 + ',' + startY + ')'; })
                    .attr("class", "down")
                    
                svg
                    .exit()
                    .remove()                      

                svg.select('.up')
                    .attr("fill", "red")
                    .attr("x", startX)
	                .attr("width", startX)
                    .attr("opacity", 0.5)                    
                    .attr("id", function(d) { return d.key; })
                    .transition()
                    .duration(1000)
                    .attr('transform', function(d, i){return 'translate(' + i*startX + ',' + startY + ')'; })
	                .attr("height", function(d) { return upMap(d.value[upVar] || 0); })
	                .attr("y", function(d) { return -upMap(d.value[upVar] || 0); })
            

                svg.select('.down')
	                .attr("fill", "steelblue")
                    .attr("x", startX)
                    .attr("width", startX)
                    .attr("opacity", 0.5)
                    .attr("id", function(d) { return d.key; })
                    .transition()
                    .duration(1000)
                    .attr('transform', function(d, i){return 'translate(' + i*startX + ',' + startY + ')'; })
	                .attr("height", function(d) { return downMap(d.value[downVar] || 0); })
            
            
            return [downVar, upVar]
            
        }
            var Vars = update(upVar, downVar);
            console.log(Vars);
            
            d3.select('#btn')
                .on('click', function(){
                     Vars = update(Vars[0], Vars[1])
                     console.log(Vars);
                })
                              
            });
            
                

        
        </script>
    </body>

    

</html>